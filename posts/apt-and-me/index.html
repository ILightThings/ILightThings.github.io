<!doctype html><html lang=en-us><head><title>APT and Me // iLightThings: A site</title>
<link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.120.4"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="iLightThings"><meta name=description content><link rel=stylesheet href=/ilightthings.github.io/css/main.min.5b1fcc8902588589c4767187402a3c29f8b8d7a6fdef6d9f8f77045bb0d14fee.css><meta name=twitter:card content="summary"><meta name=twitter:title content="APT and Me"><meta name=twitter:description content="APT and me So I have been starting to break into APT research and learning how various state sponsored groups conduct there attacks. The easiest way I have found is reading papers on https://samples.vx-underground.org/APTs where a number of articles are consolidated and collected in PDF format.
A group I see time and time again is APT41 which is speculated to be a CN hacker group. They go by a number of aliases, which I won&rsquo;t go into but I watch there attack patterns that are very similar to those taught in the OSEP."><meta property="og:title" content="APT and Me"><meta property="og:description" content="APT and me So I have been starting to break into APT research and learning how various state sponsored groups conduct there attacks. The easiest way I have found is reading papers on https://samples.vx-underground.org/APTs where a number of articles are consolidated and collected in PDF format.
A group I see time and time again is APT41 which is speculated to be a CN hacker group. They go by a number of aliases, which I won&rsquo;t go into but I watch there attack patterns that are very similar to those taught in the OSEP."><meta property="og:type" content="article"><meta property="og:url" content="ilightthings.github.io/posts/apt-and-me/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-04T09:00:00-04:00"><meta property="article:modified_time" content="2022-08-04T09:00:00-04:00"></head><body><header class=app-header><a href=ilightthings.github.io><img class=app-header-avatar src=/ilightthings.github.io/nice.jpg alt=iLightThings></a>
<span class=app-header-title>iLightThings: A site</span><nav class=app-header-menu><a class=app-header-menu-item href=ilightthings.github.io/tags/>Tags</a></nav><p>Hello, my name is iLightThings, and this is a technical blog about my experiences and adventures in the world of cyber security, with a focus on redteaming, windows exploitation, network attacks, and custom tool designed.</p><div class=app-header-social><a href=https://github.com/ILightThings target=_blank rel="noreferrer noopener me"><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>My Github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>APT and Me</h1><div class=post-meta><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Aug 4, 2022</div><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>3 min read</div><div><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=ilightthings.github.io/tags/apt/>APT</a>
<a class=tag href=ilightthings.github.io/tags/research/>research</a></div></div></header><div class=post-content><h1 id=apt-and-me>APT and me</h1><p>So I have been starting to break into APT research and learning how various state sponsored groups conduct there attacks. The easiest way I have found is reading papers on <a href=https://samples.vx-underground.org/APTs>https://samples.vx-underground.org/APTs</a> where a number of articles are consolidated and collected in PDF format.</p><p>A group I see time and time again is APT41 which is speculated to be a CN hacker group. They go by a number of aliases, which I won&rsquo;t go into but I watch there attack patterns that are very similar to those taught in the OSEP.</p><h2 id=microsoft-word>Microsoft Word</h2><h3 id=introduction-into-the-network>Introduction into the network</h3><p>The inital attack vector is not anything new. An infected microsoft word doc with a &ldquo;Content enable&rdquo; bait that would render after the button is hit. The topic of the doucment would range depending on the target. If it was a government target, it would be a memo doc. If it was a company, they might target a companies HR with a resume file.</p><h3 id=something-new-template-injection>Something new? Template Injection</h3><p>BUT! Where it differs is by doing something called template injection where a doc file can call a remotely hosted dotm (word doc template) which contained macros that would fire.
It is still possible to use docx because of template injection.</p><h3 id=activate-macro>Activate Macro</h3><p>Here is where it would get interesting. Once the macro is activiated, one of the neat vectors would download a couple of target files and then set a LNK file in the start up folder.
So that attack would not launch until the computer restarted.</p><p>From the report, it is hard to tell if the files were downloaded or if they were embeded into the macro itself but regardless, we know that attack is dropping files to disk.</p><h3 id=the-files>The files</h3><p>The files themeselvs are:
An .net executable that impersonates a ESET cli utility that uses and invalidly signed cert (Note to self, look up signing).</p><p>the ini file is a AES encrypted payload.</p><h3 id=the-net-executable>The .Net Executable</h3><p>The executable is pretty interesting. It does an http request to <a href=https://ip-api.com>https://ip-api.com</a> to get the country code. If the country code is US or RU, it does not process and exits. It is speculated that the RU is potentially a false flag op to draw sus away from APT 41.</p><p>When the check is done and passed, the ini file is decrypted with key that was stroed, and the VirtualAlloc and CreateThread are called to run the resulting shellcode.</p><h3 id=c2-communications>C2 Communications</h3><p>Here its gets a bit boring. Standard C2 framework stuff. The C2 communcates over HTTPS and uses <code>/jquery</code> and <code>/jquery-min</code> endpoints that contain valid jquery lib data but then has a few bytes in the code to communicate its evil deeds.</p><p>Tools:
Fiddler</p><h2 id=what-was-learned>What was learned:</h2><p>In this APT profile, we learned about microsoft word template injection, passing a LNK file to the startup folder to get and maintain persistance on next reboot, using <a href=https://ip-api.com>https://ip-api.com</a> to get a country code and filter out desired countries and using jquery lib (which is notriously large) to hide the commication.</p><h3 id=potential-future-vectors>Potential future vectors</h3><ul><li>Using <a href=https://ip-api.com>https://ip-api.com</a> to filter out results from non client IPs (large client with IP blocks only)</li></ul><hr><h2 id=references>References</h2><p>APT - VX-underground.org</p><ul><li><a href=https://samples.vx-underground.org/APTs/2020/2020.06.17(1)/Paper/Cobalt%20Strike.pdf>https://samples.vx-underground.org/APTs/2020/2020.06.17(1)/Paper/Cobalt%20Strike.pdf</a></li></ul><p>Microsoft Word Template Injecion</p><ul><li><a href=https://blog.sunggwanchoi.com/remote-template-injection/>https://blog.sunggwanchoi.com/remote-template-injection/</a></li></ul></div><div class=post-footer></div></article></main></body></html>